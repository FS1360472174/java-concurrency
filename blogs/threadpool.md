# 摘要
为什么需要线程池呢，没想明白这个问题，看再多线程池的源码都没有用，先要知道线程池技术解决了什么问题，才能看的懂源码，因为所有的代码都是为了解决实际的工程问题。

# 问题
抛几个问题，看看你是否知道，不知道的话，可能你对线程池的理解还不够深入，还是一知半解。那么本文会对你有用，请继续看下去

- 线程池的线程数可以为1吗？
- 线程数为1的线程池有存在的必要吗
- 2个有5个核心线程的线程池和1个有10个核心线程的线程池有什么区别
- 一个应用中如何管理线程池
- 线程池池化技术和消息队列有什么区别

# 线程池原理
在大学里我们学习c语言时，一个main函数写到底，就可以交作业了。刚开始工作时，mvc一路controller -> service -> dao就OK了。但是工作中写代码是要解决实际问题的。你啪啪啪写完了代码，用户发现你这个接口响应太慢了，怎么办?

![在这里插入图片描述](https://img-blog.csdnimg.cn/2019050412075941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9mYW5nemhhbmcuYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
用户提交任务到程序执行完成，大致的过程如上图，提交一个task，然后有个线程去执行。
所以要提高​程序执行的效率可以从两个方面来考虑
1. 异步,先响应，返回中间结果，然后异步处理，将结果返回
2. 并发，多个线程来执行。

本篇说的线程池主要就是从1的维度来提高程序执行的效率

# 生产者消费者模式
有一定工作经验的朋友对消息队列的削峰填谷，系统解耦肯定不陌生。那么线程池，算不算削峰填谷呢？
异步化后，相当于把所有的task放在了队列中。也就是生产者 -> 容器 -> 消费者。如下图
![在这里插入图片描述](https://img-blog.csdnimg.cn/20190504123059290.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9mYW5nemhhbmcuYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)
从图可以看出，线程池技术使系统复杂了，也提供了更多的灵活性。通过队列的形式，我们将任务的执行拆分成了生产者，消费者模式。每一步只用关心自己的事情。如果我们的任务很复杂，我们可以将任务拆分成不同的步骤，每一步骤可以使用不同的线程池来解决，以此来提高效率。


# 可管理性
看上去通过线程池完美解决了我们的问题，那么需要付出什么代价呢？`cpu的资源是有限的，线程的创建也需要代价`，我们一个java应用进程的资源是毕竟是有限的。我们不可能在应用中无限的创建线程池。所以我们需要管理线程池。

通常，对于简单的应用，我们使用一个单例线程池即可，让应用中的所有task都使用同一个线程池，防止一些初级程序员在应用中随意创建线程池，导致线程资源吃紧，线程占用过多的资源。

当应用中task比较复杂的时候，我们就需要使用分治的思想，对线程池进行隔离。
比如有些是cpu密集型的，有些是IO密集型的；任务的重要程度也有轻重之分；任务的执行时间也有不同。我们需要对为这些任务建立不同的线程池，以此来提高效率。


# 总结
线程池是一种异步化技术，通过预先创建线程/异步处理来提高响应速度。同时通过统一调配线程资源，可以降低线程的重复创建问题，提高线程的利用率，中心化管理有利于对资源的有效控制，防止滥用。
 


欢迎加入Java互联网技术交流群 392669336
<a target="_blank" href="https://jq.qq.com/?_wv=1027&k=5C9LDY8">
<img border="0" src="//pub.idqqimg.com/wpa/images/group.png" alt="Java互联网技术" title="Java互联网技术"></a>

**关注【方丈的寺院】，与方丈一起开始技术修行之路**
![在这里插入图片描述](https://img-blog.csdnimg.cn/20190418000000125.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9mYW5nemhhbmcuYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)